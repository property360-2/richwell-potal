{% extends "base.html" %}

{% block title %}Payment Receipt - Richwell Colleges{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Receipt Card -->
            <div class="card shadow-lg">
                <div class="card-header bg-success text-white text-center py-4">
                    <h2 class="mb-0">
                        <i class="fas fa-check-circle"></i> Payment Received
                    </h2>
                </div>

                <div class="card-body p-5">
                    <!-- Receipt Header -->
                    <div class="text-center mb-4">
                        <h3>Richwell Colleges</h3>
                        <p class="text-muted small mb-3">Official Payment Receipt</p>
                        <hr>
                    </div>

                    <!-- Receipt Info -->
                    <table class="table table-borderless mb-4">
                        <tbody>
                            <tr>
                                <td class="fw-bold">Receipt #:</td>
                                <td class="text-end">{{ payment.receipt_number|default:"AUTO-GENERATED" }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Date:</td>
                                <td class="text-end">{{ payment.created_at|date:"F d, Y H:i A" }}</td>
                            </tr>
                            <tr class="table-active">
                                <td class="fw-bold">Payment Mode:</td>
                                <td class="text-end">
                                    {% if payment.payment_mode == 'CASH' %}
                                        <span class="badge bg-primary">Cash</span>
                                    {% elif payment.payment_mode == 'ONLINE' %}
                                        <span class="badge bg-info">Online Transfer</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ payment.payment_mode }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Student Info -->
                    <div class="bg-light p-3 rounded mb-4">
                        <h5 class="mb-3">Student Information</h5>
                        <table class="table table-sm table-borderless mb-0">
                            <tbody>
                                <tr>
                                    <td class="fw-bold" style="width: 30%;">Name:</td>
                                    <td>{{ student.user.get_full_name }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Student #:</td>
                                    <td>{{ student.student_number }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Program:</td>
                                    <td>{{ student.program.code }} - {{ student.program.name }}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Email:</td>
                                    <td>{{ student.user.email }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Payment Breakdown -->
                    <div class="bg-light p-3 rounded mb-4">
                        <h5 class="mb-3">Payment Amount</h5>
                        <table class="table table-borderless mb-0">
                            <tbody>
                                <tr>
                                    <td class="fw-bold">Amount Paid:</td>
                                    <td class="text-end">PHP {{ payment.amount|floatformat:2 }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Payment Status -->
                    <div class="bg-light p-3 rounded mb-4">
                        <h5 class="mb-3">Updated Payment Status</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Month</th>
                                        <th>Required</th>
                                        <th>Paid</th>
                                        <th>Remaining</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for month in payment_status.months %}
                                        <tr class="{% if month.is_fully_paid %}table-success{% endif %}">
                                            <td><strong>Month {{ month.month_number }}</strong></td>
                                            <td>PHP {{ month.required_amount|floatformat:2 }}</td>
                                            <td>PHP {{ month.paid_amount|floatformat:2 }}</td>
                                            <td>PHP {{ month.remaining_amount|floatformat:2 }}</td>
                                            <td>
                                                {% if month.is_fully_paid %}
                                                    <span class="badge bg-success">PAID</span>
                                                {% else %}
                                                    <span class="badge bg-warning">PENDING</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <strong>Total Required:</strong> PHP {{ payment_status.total_required|floatformat:2 }}
                            </div>
                            <div class="col-6 text-end">
                                <strong>Total Paid:</strong> PHP {{ payment_status.total_paid|floatformat:2 }}
                            </div>
                        </div>
                        <div class="mt-2">
                            <div class="progress" style="height: 25px;">
                                <div
                                    class="progress-bar bg-success"
                                    role="progressbar"
                                    style="width: {{ payment_status.percentage_paid|floatformat:1 }}%"
                                    aria-valuenow="{{ payment_status.percentage_paid|floatformat:1 }}"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                >
                                    {{ payment_status.percentage_paid|floatformat:1 }}% Complete
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exam Eligibility -->
                    {% if payment_status.first_month_paid %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <strong>Exam Eligible!</strong> Month 1 payment complete. Student can now enroll in subjects and take exams.
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-circle"></i>
                            <strong>Payment Pending:</strong> Student must complete Month 1 payment before enrolling in subjects.
                        </div>
                    {% endif %}

                    <!-- Important Info -->
                    <div class="card border-warning mt-4">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fas fa-info-circle text-warning"></i> Important Information
                            </h6>
                            <ul class="small mb-0">
                                <li>This receipt is an official proof of payment</li>
                                <li>Please retain for your records</li>
                                <li>For concerns, contact the Cashier's office</li>
                                <li>Transaction is logged in our audit system</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-light text-center py-3">
                    <button onclick="window.print()" class="btn btn-secondary btn-sm me-2">
                        <i class="fas fa-print"></i> Print Receipt
                    </button>
                    <a href="{% url 'sis:cashier_dashboard' %}" class="btn btn-primary btn-sm">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        body {
            background-color: white;
        }
        .card {
            box-shadow: none;
            border: 1px solid #dee2e6;
        }
        .btn, .card-footer {
            display: none;
        }
    }
</style>
{% endblock %}
